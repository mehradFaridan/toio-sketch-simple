<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/konva/8.3.2/konva.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
  </head>
  <body onclick="changeBehavior()">
    <div id="canvas"></div>
    <script>
    
      // If clicked is false, keep drawing on page
      let clicked = false
      // Initial run through array will be from top to down
      let goingUp = false
      // Start array index at 0
      let index = 0
      // Heading down array at first
      let increment = -2

      const socket = io()

      let width = window.innerWidth
      let height = window.innerHeight
      
      let stage = new Konva.Stage({
        container: 'canvas',
        width: width,
        height: height,
      })
      
      let layer = new Konva.Layer()
      stage.add(layer)
      
      let isPaint = false
      let mode = 'brush'
      let lastLine

      line = new Konva.Line({
        stroke: '#df4b26',
        strokeWidth: 5,
        lineCap: 'round',
        points: [],
      })
    
      layer.add(line)

      function changeBehavior(){
        clicked = true

    }

      socket.on('pos', (data) => {
        // console.log(data)
        let cubes = data.cubes
        let cube = cubes[0]
        let x = cube.x
        let y = cube.y

        // If click hasn't occured yet, then continue
        // drawing toio co-ordinates on page
        if(clicked === false){

          let newPoints = line.points().concat([x, y])
          line.points(newPoints)
          index = line.points().length

        } 
        
        // If click has occured, then send the points 
        // in the line's array to server
        else {
          
          // if index is smaller than or equal to 0, then the 
          // index must be incremented upwards & start at 0
          // increment by 2 since we're going up the array
          if(index <= 0){

            goingUp = true
            index = 0
            increment = 2

          }

          // if index is larger than array then index must increment
          // down through array & start at max length of points array.
          // increment by -2 since we're going down the array
          else if(index > line.points().length){

            //goingUp = false
            //index = line.points().length
            //increment = -2
            index = 0
            increment = 2
            goingUp = true

          }

          // Since the line.points array is a flattened array,
          // every even index is an x value and every odd 
          // index is a y value           
          let targetX = line.points()[index]
          let targetY = line.points()[index + 1]

          console.log("i = ", index)
          console.log("x = ", targetX)
          console.log("y = ", targetY)

          // Emitting move positions back to the server
          socket.emit('move', targetX, targetY)

          index += increment



          // for(i = 0; i < line.points().length; i+=4){

          //   console.log(i)

          //   // Since the line.points array is a flattened array,
          //   // every even index is an x value and every odd 
          //   // index is a y value 
          //   let targetX = line.points()[i]
          //   let targetY = line.points()[i + 1]

          //   // console.log("i = ", i)
          //   // console.log("x = ", x)
          //   // console.log("y = ", y)
              
          //   // Emitting move positions back to the server
          //   socket.emit('move', targetX, targetY)

          // }

          // for(i = line.points().length; i > 0; i-=4){

          //   //console.log(i)

          //   // Since the line.points array is a flattened array,
          //   // every even index is an x value and every odd 
          //   // index is a y value 
          //   let targetX = line.points()[i]
          //   let targetY = line.points()[i + 1]

          //   // console.log("i = ", i)
          //   // console.log("x = ", x)
          //   // console.log("y = ", y)

          //   // Emitting move positions back to the server
          //   socket.emit('move', targetX, targetY)

          // }

          // // Declaring increment value for array index
          // let increment
          
          // // If index is greater than length of array
          // // then it's time to head down the array
          // if(i > line.points().length){

          //   goingUp = false

          // }

          // // If index is smaller than 0, then it's
          // // time to head back up the array
          // if(i < 0){

          //   goingUp = true

          // }


          // // If going up through array, then increment by 20
          // if(goingUp){
            
          //   increment = 2

          // }

          // // If going down through array, then decrement by 20
          // else{

          //   increment = -2

          // }

          // // Increment i
          // i += increment

        }

      })

    </script>
  </body>
</html>
